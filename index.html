<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>심화 탐구 통합 워크북</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@700;900&family=Noto+Sans+KR:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8fafc; margin: 0; padding: 0; }
        .serif { font-family: 'Noto Serif KR', serif; }
        @media print { .no-print { display: none !important; } .print-only { display: block !important; } }
        .print-only { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // 선생님의 구글 앱스 스크립트 주소 (그대로 유지)
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwozNNnGBT-iJtUzLAlalEJdEn_oEDMt3IIqNBwMHPuEQhmwvUi_x1-AbXDJoydCKcX/exec";

        const App = () => {
            const [personalCode, setPersonalCode] = useState("");
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [isLoading, setIsLoading] = useState(false);
            const [studentInfo, setStudentInfo] = useState({ school: "공주여자고등학교", gradeClass: "", name: "", major: "" });
            const [sessionData, setSessionData] = useState({ motive: "", question: "", book: "", log: "", summary: "" });
            const [activeTab, setActiveTab] = useState("기본정보");

            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [isLoggedIn, activeTab]);

            const handleLogin = async (e) => {
                e.preventDefault();
                if (!personalCode.trim()) return alert("코드를 입력하세요.");
                setIsLoading(true);
                try {
                    const res = await fetch(`${SCRIPT_URL}?userKey=${encodeURIComponent(personalCode)}`);
                    const json = await res.json();
                    if (json) {
                        setStudentInfo({ school: json.school, gradeClass: json.gradeClass, name: json.name, major: json.major });
                        setSessionData({ motive: json.motive, question: json.question, book: json.book, log: json.log, summary: json.summary });
                    }
                    setIsLoggedIn(true);
                } catch (err) { setIsLoggedIn(true); } 
                setIsLoading(false);
            };

            const saveData = async () => {
                setIsLoading(true);
                try {
                    await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ userKey: personalCode, ...studentInfo, ...sessionData }) });
                    alert("구글 시트에 안전하게 보관되었습니다.");
                } catch (err) { alert("저장 실패. 인터넷을 확인하세요."); }
                setIsLoading(false);
            };

            if (!isEntry && !isLoggedIn) return (
                <div className="min-h-screen flex items-center justify-center bg-slate-900 p-6 text-center">
                    <div className="max-w-md w-full bg-white rounded-[40px] shadow-2xl p-10 border-t-[12px] border-emerald-800">
                        <h1 className="serif text-3xl font-black mb-10 text-slate-800 tracking-tighter">탐구 마스터 시스템</h1>
                        <form onSubmit={handleLogin} className="space-y-6">
                            <input type="text" value={personalCode} onChange={(e) => setPersonalCode(e.target.value)} placeholder="개인 코드 입력" className="w-full p-5 rounded-2xl bg-slate-50 border-2 border-slate-100 text-center font-bold text-lg" />
                            <button className="w-full bg-emerald-800 text-white p-5 rounded-2xl font-black shadow-lg hover:bg-emerald-900 transition-all">
                                {isLoading ? "로딩 중..." : "입장하기"}
                            </button>
                        </form>
                        <p className="mt-8 text-xs text-slate-400 font-bold">공주여자고등학교 이수연 선생님 제작</p>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen flex flex-col bg-slate-50">
                    <header className="no-print bg-white border-b px-8 py-4 flex justify-between items-center sticky top-0 z-50 shadow-sm">
                        <div className="flex items-center gap-3">
                            <h2 className="serif font-black text-xl text-slate-800">심화 탐구 통합 리포트</h2>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={saveData} className="bg-emerald-700 text-white px-6 py-2 rounded-xl text-xs font-black shadow-md">{isLoading ? "저장 중..." : "서버 저장"}</button>
                            <button onClick={() => window.print()} className="bg-slate-900 text-white px-6 py-2 rounded-xl text-xs font-black">인쇄</button>
                        </div>
                    </header>
                    <main className="no-print p-6 max-w-4xl mx-auto w-full">
                        <div className="bg-white rounded-[40px] shadow-xl p-12 min-h-[500px]">
                            <h3 className="serif text-2xl font-black mb-8 border-b pb-4 tracking-tighter">정보 입력</h3>
                            <textarea 
                                value={sessionData.motive}
                                onChange={(e) => setSessionData({...sessionData, motive: e.target.value})}
                                className="w-full h-80 p-8 rounded-3xl bg-slate-50 outline-none text-lg shadow-inner"
                                placeholder="이곳에 탐구 내용을 기록하세요."
                            />
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
